<html>

<head>
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>

<body>
  <a-scene embedded arjs="patternRatio:0.9">
    <a-marker type="pattern" url="./assets/pattern-marker.patt">
      <a-plane id="gifPlane" position="0 0 0" rotation="-90 0 0" width="2" height="2"></a-plane>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // GIFを読み込む
    const gifImg = new Image();
    gifImg.src = './assets/karapare25.11.gif';
    gifImg.crossOrigin = "anonymous";

    gifImg.onload = () => {
      // Canvas を作成
      const canvas = document.createElement('canvas');
      canvas.width = gifImg.width;
      canvas.height = gifImg.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(gifImg, 0, 0);

      // A-Frame plane に canvas を貼る
      const plane = document.querySelector('#gifPlane');
      plane.setAttribute('material', 'src', canvas);

      // 簡易GIF再生 (1フレームずつはできないので全体をループ描画)
      setInterval(() => {
        ctx.drawImage(gifImg, 0, 0);
        plane.getObject3D('mesh').material.map.needsUpdate = true;
      }, 100); // 10fps程度
    };
  </script>

</body>

</html>
